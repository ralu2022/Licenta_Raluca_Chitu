<!doctype html >
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Luana Nature</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/.css/css.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
    <style>
        .card {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card img {
            object-fit: cover;
            height: 350px;
        }

        .card-body {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table th, table td {
            border: 1px solid #ddd;
            padding: 8px;
        }

        table th {
            background-color: #f2f2f2;
            text-align: center;
        }
    </style>
</head>
<body style="background-color: bisque;">


<!-- Meniu -->
<nav class="navbar navbar-expand-sm bg-white fixed-top">
    <div class="container-fluid">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavleft">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/mainpageuser}"><b>Acasă</b></a>
                </li> <!-- Acasă-->
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/companiesuser}"><b>Companii</b></a>
                </li> <!-- Companii -->
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/individualsuser}"><b>Individual</b></a>
                </li> <!-- Individual -->
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/kidsuser}"><b>Lumea copiilor</b></a>
                </li> <!-- Lumea copiilor -->
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/cateringuser}"><b>Catering</b></a>
                </li> <!-- Catering -->
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/reviews/review}"><b>Recenzie nouă</b></a>
                </li> <!-- Recenzie -->
            </ul>
        </div>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/index}"><b>Delogare</b></a>
                </li><!-- Delogare -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                       data-bs-toggle="dropdown" aria-expanded="false">
                        <b>Rezervări</b>
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" th:href="@{/reservations/reservations}">Rezervările mele</a></li>
                        <li><a class="dropdown-item" th:href="@{/reservations/reservation}">Rezervare nouă</a></li>
                    </ul>
                </li> <!-- Rezervări-->
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/aboutususer}"><b>Despre noi</b></a>
                </li> <!-- Despre noi -->
                <li class="nav-item">
                    <a class="nav-link"
                       th:href="@{/contact}"><b>Contact</b></a>
                </li> <!-- Contact -->
            </ul>
        </div>
    </div>
</nav>
<br>

<!-- Imagine sus -->
<div class="card" style="width: 100%; position: relative;">
    <img class="card-img-top" src="/pictures/magazin_0.webp" alt="Centered image" style="height: 500px;
    width: 100%;object-fit: cover;">
</div>
<br>

<!-- Produse -->
<div class="container mt-5">
    <h2 style="color:chocolate; text-align: center; font-family: 'Comic Sans MS'; font-size:4rem">PRODUSELE NOASTRE</h2>
    <br><br>
    <div class="d-flex gap-2 mb-3">
        <input type="text" id="searchInput" class="form-control form-control-sm w-50"
               placeholder="Caută produse..." onkeyup="filterProducts()">
        <select id="sortOptions" class="form-select form-select-sm w-25" onchange="sortProducts()">
            <option value="default">Sortează</option>
            <option value="name">Nume (A-Z)</option>
            <option value="priceLow">Preț ⬆</option>
            <option value="priceHigh">Preț ⬇</option>
        </select>
    </div>
    <div class="row">
        <div th:each="product : ${products}" class="col-md-4">
            <div class="card mb-4">
                <img th:src="@{/pictures/produse_1.jpeg}"
                     th:if="${product.name == 'Honey Bunny'}"
                     class="card-img-top" alt="Imagine produs">
                <img th:src="@{/pictures/produse_0.jpg}"
                     th:if="${product.name == 'Greeny'}"
                     class="card-img-top" alt="Imagine produs">
                <img th:src="@{/pictures/produse_10.webp}"
                     th:if="${product.name == 'Puffy cups'}"
                     class="card-img-top" alt="Imagine produs">
                <img th:src="@{/pictures/produse_3.jpg}"
                     th:if="${product.name == 'Lavander'}"
                     class="card-img-top" alt="Imagine produs">
                <img th:src="@{/pictures/produse_6.jpg}"
                     th:if="${product.name == 'Vanilla'}"
                     class="card-img-top" alt="Imagine produs">
                <img th:src="@{/pictures/produse_4.jpg}"
                     th:if="${product.name == 'Clock'}"
                     class="card-img-top" alt="Imagine produs">
                <img th:src="@{/pictures/produse_7.webp}"
                     th:if="${product.name == 'Tiny Human'}"
                     class="card-img-top" alt="Imagine produs">
                <img th:src="@{/pictures/produse_9.jpeg}"
                     th:if="${product.name == 'Flower'}"
                     class="card-img-top" alt="Imagine produs">
                <img th:src="@{/pictures/produse_8.jpg}"
                     th:if="${product.name == 'Happy'}"
                     class="card-img-top" alt="Imagine produs">
                <div class="card-body">
                    <h5 class="card-title" th:text="${product.name}">Denumire produs</h5>
                    <p class="card-text">
                        Preț: <span th:text="${product.price}">Pret</span> RON
                    </p>
                    <p class="card-text">
                        Descriere: <span th:text="${product.description}">Descriere</span>
                    </p>
                    <button class="btn btn-primary"
                            th:attr="data-product-name=${product.name}, data-product-price=${product.price}"
                            onclick="handleAddToOrder(this)"
                            type="button">Adaugă la comanda
                    </button>
                </div>
            </div>
        </div>
    </div>
    <br><br>
    <h2>Comanda ta</h2>
    <table id="orderTable">
        <thead>
        <tr>
            <th>Denumire produs</th>
            <th>Preț per bucată (RON)</th>
            <th>Cantitate</th>
            <th>Total pe linie (RON)</th>
        </tr>
        </thead>
        <tbody id="orderPreview">
        </tbody>
        <tfoot>
        <tr>
            <td colspan="3"><b>Total pe comandă</b></td>
            <td id="totalOrdered">0.00 RON</td>
        </tr>
        </tfoot>
    </table>
    <br>
    <button onclick="submitOrder()" class="btn btn-success">Trimite comanda</button>
    <br><br>
</div>

<br>

<!-- Nota subsol -->
<footer class="text-center text-lg-start bg-body-tertiary text-muted">
    <section class="d-flex justify-content-center justify-content-lg-between p-4 border-bottom">
    </section>
    <section class="">
        <div class="container text-center text-md-start mt-5">
            <div class="row mt-3">
                <div class="col-md-3 col-lg-4 col-xl-3 mx-auto mb-4">
                    <h6 class="text-uppercase fw-bold mb-4">
                        <i class=""></i>Luana Nature
                    </h6>
                </div>
                <div class="col-md-2 col-lg-2 col-xl-2 mx-auto mb-4">
                    <h6 class="text-uppercase fw-bold mb-4">
                        Link-uri utile
                    </h6>
                    <p>
                        <a th:href="@{/companiesuser}" class="text-reset">Companii</a>
                    </p>
                    <p>
                        <a th:href="@{/individualsuser}" class="text-reset">Individual</a>
                    </p>
                    <p>
                        <a th:href="@{/kidsuser}" class="text-reset">Lumea copiilor</a>
                    </p>

                </div>

                <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4">
                    <h6 class="text-uppercase fw-bold mb-4">Contact</h6>
                    <p><i class="fas fa-home me-3"></i> Comuna Fundata, Brasov, RO</p>
                    <p>
                        <i class="fas fa-envelope me-3"></i>
                        luananature2024@gmail.com
                    </p>
                    <p><i class="fas fa-phone me-3"></i> + 40 268 477 698</p>
                    <p><i class="fas fa-mobile-alt me-3"></i> + 40 724 789 718</p>
                    <h6 class="text-uppercase fw-bold mb-4">Rețele sociale</h6>
                    <a href="https://www.facebook.com/profile.php?id=61569606121431" class="me-4"
                       style="color: darkslategrey">
                        <p><i class="fab fa-facebook-f"></i> Facebook </p>
                    </a>
                    <a href="https://www.instagram.com/" class="me-4 text-reset">
                        <p><i class="fab fa-instagram"></i> Instagram </p>
                    </a>
                </div>
                <div>
                </div>
            </div>
        </div>
    </section>

    <div class="text-center p-4 me-3" style="background-color: rgba(0, 0, 0, 0.05);">
        © 2024 Luana Nature
    </div>
</footer>

<script>
    const order = [];

    function handleAddToOrder(buttonElement) {
        const productName = buttonElement.getAttribute('data-product-name');
        const productPrice = parseInt(buttonElement.getAttribute('data-product-price'));

        if (isNaN(productPrice)) {
            alert(`Prețul este invalid: ${productName}`);
            return;
        }

        addToOrder(productName, productPrice);
    }

    function addToOrder(productName, price) {
        const existingProduct = order.find(item => item.name === productName);
        if (existingProduct) {
            existingProduct.quantity += 1;
        } else {
            order.push({name: productName, price: price, quantity: 1});
        }
        updateOrderPreview();
    }

    function updateOrderPreview() {
        const orderPreview = document.getElementById('orderPreview');
        const totalOrderedElement = document.getElementById('totalOrdered');
        orderPreview.innerHTML = '';

        let totalOrdered = 0;

        order.forEach((item, index) => {
            const total = item.price * item.quantity;
            const row = document.createElement('tr');
            row.innerHTML = `
            <td>${item.name}</td>
            <td>${item.price.toFixed(2)}</td>
            <td>${item.quantity}</td>
            <td>${total.toFixed(2)}</td>
            <td>
                <button class="btn btn-danger btn-sm" onclick="removeFromOrder(${index})">Șterge</button>
            </td>
        `;
            orderPreview.appendChild(row);
            totalOrdered += total;
        });
        totalOrderedElement.textContent = `${totalOrdered.toFixed(2)} RON`;
    }

    function removeFromOrder(index) {
        order.splice(index, 1);
        updateOrderPreview();
    }

    async function submitOrder() {
        if (order.length === 0) {
            alert('Comanda ta nu are produse');
            return;
        }

        for (const item of order) {
            const productData = {
                productName: item.name,
                orderedQuantity: item.quantity,
                pricePerItem: item.price,
                totalPrice: (item.price * item.quantity).toFixed(2),
                orderDate: new Date().toISOString().split('T')[0],
                status: 'Pending'
            };

            try {
                const response = await fetch('/orders/addorder', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams(productData).toString()
                });


                if (!response.ok) {
                throw new Error('Eroare la trimiterea comenzii');
            }

            alert('Comanda a fost trimisă cu succes!');
            order.splice(0, order.length);
            updateOrderPreview();
        } catch (error) {
            alert('O eroare a fost întâmpinată!');
            console.error(error);
        }

    }}

</script> <!-- Comandă -->
<script>
    function filterProducts() {
        let input = document.getElementById("searchInput").value.toLowerCase();
        let products = document.querySelectorAll(".col-md-4");

        products.forEach(product => {
            let title = product.querySelector(".card-title").textContent.toLowerCase();
            product.style.display = title.includes(input) ? "block" : "none";
        });
    }

</script> <!-- Filtrare -->
<script>
    function sortProducts() {
        let sortOption = document.getElementById("sortOptions").value;
        let container = document.querySelector(".row");
        let products = Array.from(container.children);

        products.sort((a, b) => {
            let nameA = a.querySelector(".card-title").textContent.toLowerCase();
            let nameB = b.querySelector(".card-title").textContent.toLowerCase();
            let priceA = parseFloat(a.querySelector(".card-text span").textContent);
            let priceB = parseFloat(b.querySelector(".card-text span").textContent);

            return sortOption === "name" ? nameA.localeCompare(nameB) :
                sortOption === "priceLow" ? priceA - priceB :
                    sortOption === "priceHigh" ? priceB - priceA : 0;
        });

        products.forEach(product => container.appendChild(product));}

</script> <!-- Sortare -->

</body>
</html>
